# 系統架構說明

## 整體架構

```
┌─────────────────────────────────────────────────────────────────┐
│                        事實查核系統                              │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   LINE Bot      │    │   Web Browser   │    │   Mobile App    │
│                 │    │                 │    │                 │
│ 發送session_id  │    │ 手動輸入查詢    │    │ 響應式界面      │
│ 到網站URL       │    │ 並開始分析      │    │ 觸控操作        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   Nginx         │
                    │   (反向代理)    │
                    │   Port: 80      │
                    └─────────────────┘
                                 │
                    ┌─────────────────┐
                    │   React App     │
                    │   (前端)        │
                    │   Port: 5173    │
                    └─────────────────┘
                                 │
                    ┌─────────────────┐
                    │   Node.js API   │
                    │   (後端)        │
                    │   Port: 3000    │
                    └─────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Cofact API    │    │   AI Models     │    │   Database      │
│   (事實查核)    │    │   (多代理)      │    │   (可選)        │
│                 │    │                 │    │                 │
│ 初步查證        │    │ LLM/SLM/法庭    │    │ 存儲分析結果    │
│ 相似度比對      │    │ 辯論系統        │    │ 用戶會話        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 數據流程

### 1. LINE整合流程

```
LINE Bot → 生成session_id → 發送URL → 用戶點擊 → 前端載入 → 顯示分析結果
```

### 2. 網頁分析流程

```
用戶輸入 → 前端驗證 → 調用Cofact API → 調用分析API → 顯示結果
```

### 3. API數據流

```
POST /api/analyze
├── 驗證參數
├── 創建分析任務
├── 返回session_id
└── 開始後台分析

GET /api/session/{session_id}
├── 查找分析結果
├── 返回狀態和數據
└── 前端渲染結果
```

## 技術棧

### 前端
- **React 19**: 現代化UI框架
- **Vite**: 快速構建工具
- **React Router**: 路由管理
- **React Icons**: 圖標庫
- **CSS3**: 響應式設計

### 後端
- **Node.js**: JavaScript運行環境
- **Express**: Web框架
- **CORS**: 跨域支持
- **JWT**: 身份驗證
- **dotenv**: 環境變數管理

### 部署
- **Docker**: 容器化
- **Docker Compose**: 多容器編排
- **Nginx**: 反向代理和靜態文件服務
- **Alpine Linux**: 輕量級基礎鏡像

## 安全架構

```
┌─────────────────────────────────────────────────────────────────┐
│                        安全層級                                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   網絡安全      │    │   應用安全      │    │   數據安全      │
│                 │    │                 │    │                 │
│ • HTTPS加密     │    │ • JWT驗證       │    │ • 環境變數      │
│ • 防火牆規則    │    │ • CORS策略      │    │ • 敏感信息加密  │
│ • DDoS防護      │    │ • 輸入驗證      │    │ • 日誌脫敏      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 擴展性設計

### 水平擴展
- 使用負載均衡器分發請求
- 無狀態API設計
- 容器化部署支持自動擴展

### 垂直擴展
- 模塊化組件設計
- 可插拔的分析模型
- 配置化的功能開關

## 監控和日誌

```
┌─────────────────────────────────────────────────────────────────┐
│                        監控體系                                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   應用監控      │    │   基礎設施監控  │    │   業務監控      │
│                 │    │                 │    │                 │
│ • API響應時間   │    │ • CPU/內存使用  │    │ • 分析成功率    │
│ • 錯誤率        │    │ • 磁盤空間      │    │ • 用戶活躍度    │
│ • 請求量        │    │ • 網絡流量      │    │ • 功能使用率    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 部署架構

### 開發環境
```
開發者 → 本地Docker → 熱重載 → 即時測試
```

### 測試環境
```
CI/CD → 自動構建 → 測試部署 → 自動測試
```

### 生產環境
```
Git Push → CI/CD → 構建鏡像 → 部署到雲端 → 健康檢查
```

## 性能優化

### 前端優化
- 代碼分割和懶加載
- 靜態資源緩存
- Gzip壓縮
- CDN加速

### 後端優化
- API響應緩存
- 數據庫查詢優化
- 連接池管理
- 異步處理

### 基礎設施優化
- 負載均衡
- 自動擴展
- 資源監控
- 故障轉移

## 故障恢復

### 自動恢復
- 健康檢查和自動重啟
- 負載均衡故障轉移
- 數據庫連接重試

### 手動恢復
- 備份和恢復流程
- 災難恢復計劃
- 回滾機制

## 未來擴展

### 功能擴展
- 更多AI模型集成
- 實時協作功能
- 多語言支持
- 移動應用

### 技術擴展
- 微服務架構
- 事件驅動架構
- 機器學習管道
- 大數據分析
